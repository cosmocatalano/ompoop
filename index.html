<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
	<title>How many days until Omloop?</title>
	<meta name="description" content="Omloop 2025 will be on a Saturday end of February.">
	<meta name="author" content="huphtur">
	<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸš´</text></svg>">
	<style>
		@media (prefers-color-scheme: dark) {
			html {
				filter: invert(1);
			}
		}

		body {
			color: #000;
			margin-top: 20vh;
			text-align: center;
			background-color: #fff;
			text-transform: uppercase;
			font: 2em/1 'Impact', sans-serif;
		}

		b {
			display: block;
			font-size: 6em;
		}
		small {
			font-size: .8rem;
		}
	</style>
</head>

<body>
	<p>
		<b id="x">How many</b> 
		<!-- <small>or</small>
		<b id="y">How many</b>  -->
		Days until <a href="https://www.omloophetnieuwsblad.be/en">Omloop</a>
	</p>
	<p><small>(this assumes it's the last Satuday in February)</small></p>
	
	<script>

		// returns the last Saturday in feb 
		function lastSatInFeb(year) {
			// gets the last day in Feb for a given year
			// NB: the 2 in the Date() value here actually indicates March, because the month-of-year value starts at 0 = January
			// HOWEVER days of the month start counting at 1, so 0 is acually the last day of the previous month ðŸ™„
			let lastDay = new Date(year, 2, 0);

			// assining an output variable to make the linter happy
			let lastSat;

			// get the day-of-week number for the last-day-in-Feb value 
			let dayOffset = lastDay.getDay();

			// if that day-of-week number is 6 (Saturday) we're good
			if (dayOffset === 6) {
				lastSat = lastDay;
			} else {
				// use the day-of-the-week value to count back from end-of-month to the previous Saturday
				// adding 1 to account for days-of-week counting (which starts from 0 = Sunday)
				// e.g. if the last day is Tuesday (day-of-week value 3), count back 4 days to the previous Saturday
				lastSat = new Date(year, 2, -(dayOffset + 1));
			}

			//return the Date object for the last Saturday in Feb
			return lastSat;
		}

		// checks what year to use to return the last Saturday in feb
		// feeds that to lastSatInFeb to generate the next Omloop date
		function getNextOmloop() {
			// Get the current date
			const rightNow = new Date();

			// Set variable for whether or not to use this year's or next year's last Saturday in Feb date
			// default to likelier option of next calendar-year
			let nextYear = 1;

			// if current date is in Februrary (month-of-year value of 1)
			if (rightNow.getMonth() === 1) {

				// get this calendar-year's last Saturday in Feb as a Date object
				let currentYearLastFebSat = lastSatInFeb(rightNow.getFullYear());

				// compare current day-of-month with day-of-month for last Saturday in February
				// if current day-of-month is before the this calendar-year's Omloop date, use this year
				if (rightNow.getDate() < currentYearLastFebSat.getDate()) {
					let nextYear = 0;
				} 
			} else {
				//if it's January, add use this year's last date
				if (rightNow.getMonth() === 0) {
					let nextYear = 0;
				} 
			}

			// get next Omloop date value
			// if we're a next-calendar-year Omloop, add 1 to the current Date year value 
			nextOmloop = lastSatInFeb(rightNow.getFullYear() + nextYear);
			
			//return date
			return nextOmloop;
		}

		let x = document.getElementById("x");
		//let y = document.getElementById("y");
		let a = Math.ceil(Math.abs(new Date() - getNextOmloop()) / 86400000);
		x.innerHTML = `${a}`;
		//document.title = `${a} Days until Omloop`;
	</script>
</body>

</html>